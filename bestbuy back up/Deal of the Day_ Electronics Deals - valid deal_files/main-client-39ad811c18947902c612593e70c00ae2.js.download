var EmbeddedComponentRenderer=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t){e.exports=initializer},function(e,t){e.exports=React},function(e,t){e.exports=configService},function(e,t){e.exports=_},function(e,t){e.exports=analyticsQ},function(e,t,n){e.exports=n(6)()},function(e,t,n){"use strict";var r=n(7);function o(){}e.exports=function(){function e(e,t,n,o,i,c){if(c!==r){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=o,n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";n.r(t);var r=n(2),o=n.n(r),i=n(0),c=n.n(i),a=n(3),u=n.n(a),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(){return{query:f()}},f=function(){return l(window.location.search.replace(/^\?/,""),"&")},l=function(e,t){var n={};return e.split(t).forEach(function(e){var t=e.split("=");t.length>1&&(n[t[0].trim()]=t[1].trim())}),n},d=n(4);"function"==typeof Symbol&&Symbol.iterator;var h=function(e){Object.keys(e).forEach(function(t){var n=e[t],r=n.comparator,o=n.value;if(!r(o))throw new Error('Invalid arguments provided to create an APE action. Please see usage documentation. Provided "'+t+'" = '+JSON.stringify(o)+".")})},m=function(e){return y(e,function(e){return"string"==typeof e&&e.length>0})},y=function(e,t){return{value:e,comparator:t}};"function"==typeof Symbol&&Symbol.iterator;"function"==typeof Symbol&&Symbol.iterator;"function"==typeof Symbol&&Symbol.iterator;"function"==typeof Symbol&&Symbol.iterator;"function"==typeof Symbol&&Symbol.iterator;"function"==typeof Symbol&&Symbol.iterator;var v=function(e){return e=function(e){var t=Object.assign({},e),n=p();return Object.keys(t).forEach(function(e){var r=t[e];if("object"===(void 0===r?"undefined":s(r))&&null!==r){var o=r.name.split(".")[0];t[e]="query"===o?u.a.get(n,r.name,r.defaultValue||""):r.toString()}}),t}(e),Object.keys(e).sort().reduce(function(t,n){n=encodeURIComponent(n);var r=encodeURIComponent(e[n]);return t.push(n+"="+r),t},[]).join("&")},g=function(e){var t=e.creatorNamespace,n=e.componentId,r=e.contractVersion,o=e.query,i=v(o);return"/"+t+"/"+n+"/"+r+(i?"?"+i:"")},b=function(e,t,n){var r=e.creatorNamespace,o=e.componentId,i=t.querySelector("div[id^="+r+"-"+o+"]"),c=i?i.id:null;n&&c&&Object(d.dispatch)(function(e){var t=e.childInstanceId,n=e.parentInstanceId;return h({childInstanceId:m(t),parentInstanceId:m(n)}),{type:"CHILD_RELATIONSHIP",childInstanceId:t,parentInstanceId:n}}({childInstanceId:c,parentInstanceId:n}))},S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},I=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var k=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.creatorNamespace,r=t.componentId,i=t.contractVersion,c=t.parentInstanceId,a=t.query;this.componentDescriptor={creatorNamespace:n,componentId:r,contractVersion:i},this.query=a,this.parentInstanceId=c,this.config=o.a.getServiceConfig("embeddedComponentRenderer"),this.config.defaults={clientUrl:"/site/canopy/component",dedupeScriptTags:!1,dedupeLinkTags:!1}}return I(e,[{key:"run",value:function(){var e=this;return this.fetch().then(function(){return e.loadLinks()}).then(function(){return e.loadScripts()}).then(function(){return e.respond()})}},{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this;this.debug("fetch"),this.componentPath=g(S({},this.componentDescriptor,{query:this.query}));var t=""+this.config.get("clientUrl").replace(/\/$/,"")+this.componentPath;return fetch(t,{credentials:"same-origin"}).then(function(e){return e.ok?e.text():Promise.reject(new Error("Failed to fetch "+t+"\nStatus: "+e.status))}).then(function(t){e.html=t,e.initializeScriptTags=e.getInitializeScriptTags(e.html),e.linkTags=e.getLinkTags(e.html),e.srcScriptTags=e.getSrcScriptTags(e.html)})})},{key:"loadLinks",value:function(){var e=this;this.debug("loadLinks"),this.linkTags.forEach(function(t){e.html=e.html.replace(t.text,"")});var t=c.a.isComponentLoading(this.componentDescriptor),n=c.a.isComponentRegistered(this.componentDescriptor),r=this.isDedupable("dedupeLinkTags");return this.debug("isLoading",t),this.debug("isRegistered",n),this.debug("isDedupable",r),(t||n)&&r?t?new Promise(function(t,n){c.a.onLoad(e.componentDescriptor,function(){return t()})}):void 0:(t||c.a.componentIsLoading(this.componentDescriptor),Promise.all(this.linkTags.map(function(e){return new Promise(function(t,n){var r=document.createElement("link");r.rel="stylesheet",r.href=e.href,r.onload=function(){return t()},r.onerror=function(e){return n(e)},document.head.appendChild(r)}).catch(function(e){})})))}},{key:"loadScripts",value:function(){var e=this;this.debug("loadScripts");var t=c.a.isComponentRegistered(this.componentDescriptor),n=this.isDedupable("dedupeScriptTags");this.srcScriptTags.forEach(function(t){e.html=e.html.replace(t.text,"")}),t&&n||this.srcScriptTags.forEach(function(t){e.debug("Executing",t.src);var n=document.createElement("script");n.type="text/javascript",n.src=t.src,document.body.appendChild(n)})}},{key:"respond",value:function(){var e=this;return this.debug("respond"),{html:this.html,path:this.componentPath,renderCallback:function(t){var n=e.componentDescriptor,r=n.creatorNamespace,o=n.componentId;e.debug("renderCallback"),t?b(e.componentDescriptor,t,e.parentInstanceId):console.warn("component "+r+"-"+o+" is using an old version of @gvp/lib-embedded-component"),e.initializeScriptTags.forEach(function(e){eval.call(window,e)})}}}},{key:"getSrcScriptTags",value:function(e){for(var t=/<script\b.*\b(src="(.*)").*[^>](\s)*/g,n=[],r=void 0;null!==(r=t.exec(e));)n.push({text:r[0],src:r[2]});return n}},{key:"getInitializeScriptTags",value:function(e){for(var t=/<script>([\s\S]*?)<\/script>(\s)*/gm,n=[],r=void 0;null!==(r=t.exec(e));)n.push(r[1]);return n}},{key:"getLinkTags",value:function(e){for(var t=/<link rel="stylesheet" href="([^"]+)" \/>(\s)*/g,n=[],r=void 0;null!==(r=t.exec(e));)n.push({text:r[0],href:r[1]});return n}},{key:"isDedupable",value:function(e){var t=this.initializeScriptTags.filter(function(e){return e.trim().startsWith("initializer.initializeComponent")}).length===this.initializeScriptTags.length,n=c.a.isComponentLoading(this.componentDescriptor),r=c.a.isComponentRegistered(this.componentDescriptor);return t&&(n||r)&&this.config.get(e)}},{key:"debug",value:function(){if(location.href.indexOf("gvpDebug=true")>-1){for(var e,t=this.componentDescriptor,n=t.creatorNamespace+"."+t.componentId+"."+t.contractVersion,r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];(e=console).debug.apply(e,["@gvp/lib-embedded-component-renderer",n].concat(o))}}}]),e}(),O=function(e){return new k(e).run()},T=n(1),j=n.n(T),C=n(5),P=n.n(C),E=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var w=function(){function e(t,n){_(this,e),this.name=t,this.defaultValue=void 0!==n?n.toString():void 0}return E(e,[{key:"toString",value:function(){var e=this.defaultValue?"|'"+this.defaultValue+"'":"";return"$(csi."+this.name+e+")"}},{key:"toReactComponent",value:function(){return j.a.createElement(x,{value:this.toString()})}}]),e}(),x=function(e){function t(){return _(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,j.a.Component),E(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return j.a.createElement("span",{dangerouslySetInnerHTML:{__html:"<csi:vars>"+this.props.value+"</csi:vars>"}})}}]),t}();function R(e){return Promise.resolve({html:D(e),scripts:[],styles:[]})}function D(e){var t=e.creatorNamespace,n=e.componentId,r=e.contractVersion,o=e.canopyInstance,i=e.query,c=void 0===i?{}:i,a=e.onError,u=void 0===a?"continue":a,s={cn:t,cid:n,ver:r,query:Object.keys(c).reduce(function(e,t,n){return e.concat([encodeURIComponent(t)+"="+function(e){if(e instanceof w)return e.toString();return encodeURIComponent(e)}(c[t])])},[]).join("&"),onError:u};return o&&(s.canopyInstance=o),"<csi:component "+Object.keys(s).reduce(function(e,t){var n=s[t];return"query"!==t||n?(e+" "+t+'="'+n+'"').trim():e},"")+" />"}function L(e,t,n){b(e,n,t)}x.propTypes={value:P.a.string.isRequired},n.d(t,"default",function(){return R}),n.d(t,"getComponentIncludeString",function(){return D}),n.d(t,"renderComponent",function(){return R}),n.d(t,"afterServerRender",function(){return L}),n.d(t,"buildComponentPath",function(){return g}),n.d(t,"CsiVar",function(){return w}),n.d(t,"fetchComponent",function(){return O})}]);